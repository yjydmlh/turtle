# 快速入门指南

<cite>
**本文档引用的文件**  
- [README.md](file://README.md)
- [quick_start.py](file://quick_start.py)
- [run.py](file://run.py)
- [create_tables.py](file://create_tables.py)
- [requirements.txt](file://requirements.txt)
- [.env.example](file://.env.example)
- [chan.py/README.md](file://chan.py/README.md)
</cite>

## 目录
1. [简介](#简介)
2. [项目克隆与子模块初始化](#项目克隆与子模块初始化)
3. [环境依赖安装](#环境依赖安装)
4. [环境变量配置](#环境变量配置)
5. [数据库初始化](#数据库初始化)
6. [系统启动方式](#系统启动方式)
7. [常见问题排查](#常见问题排查)
8. [总结](#总结)

## 简介
本指南旨在帮助用户从零开始搭建和运行缠论分析系统。该系统基于缠中说禅理论，集成实时数据获取、多时间周期聚合、分型识别、笔段构建等核心功能，提供专业的数字货币技术分析服务。通过本指南，您将学习如何完成项目克隆、子模块初始化、依赖安装、环境配置、数据库初始化和系统启动的完整流程。

## 项目克隆与子模块初始化
要开始使用本系统，首先需要克隆项目代码库并初始化子模块。

### 克隆项目
使用以下命令克隆项目到本地：
```bash
git clone https://github.com/your-username/turtle.git
cd turtle
```

### 初始化Chan模块子模块
本系统依赖外部的`chan.py`模块来提供强大的缠论分析功能。该模块以Git子模块的形式集成，需要单独初始化：
```bash
git submodule update --init
```

执行成功后，您将在项目根目录下看到`chan.py`文件夹，其中包含完整的缠论计算框架。此模块基于Python 3.11+开发，实现了分型识别、笔的构建、线段分析、买卖点识别等核心功能。

**Section sources**
- [README.md](file://README.md#L1-L508)
- [chan.py/README.md](file://chan.py/README.md#L1-L1609)

## 环境依赖安装
系统需要Python和Node.js环境支持，分别用于后端和前端。

### Python依赖安装
确保已安装Python 3.8+版本，然后安装后端依赖：
```bash
pip install -r requirements.txt
```

该命令将安装以下核心依赖包：
- **FastAPI**: 高性能异步API框架
- **Uvicorn**: ASGI服务器
- **SQLAlchemy**: 数据库ORM
- **ccxt**: 加密货币交易API
- **pandas**: 数据处理
- **psycopg2-binary**: PostgreSQL数据库驱动

安装完成后，系统会自动检查这些依赖是否可用。

### Node.js依赖安装（可选）
如果您需要修改前端界面或进行开发，需要安装Node.js依赖：
```bash
cd frontend
npm install
```

此步骤仅在您需要开发或自定义前端时才需要执行。生产环境中，前端已预构建，可直接运行。

**Section sources**
- [requirements.txt](file://requirements.txt#L1-L18)
- [frontend/package.json](file://frontend/package.json#L1-L53)
- [README.md](file://README.md#L1-L508)

## 环境变量配置
正确配置环境变量是系统正常运行的关键。

### 创建环境配置文件
复制示例文件创建`.env`配置文件：
```bash
cp .env.example .env
```

### 配置数据库连接
编辑`.env`文件，根据您的数据库类型配置`DATABASE_URL`：

**PostgreSQL（推荐）**：
```bash
DATABASE_URL=postgresql://postgres:your_password@localhost:5432/turtle
```

**SQLite（开发测试）**：
```bash
DATABASE_URL=sqlite:///./turtle.db
```

### 其他重要配置
确保以下关键配置项已正确设置：
- `APP_NAME=turtle`: 应用名称
- `DEBUG=true`: 开发模式启用调试
- `SECRET_KEY=your-secret-key`: JWT密钥（生产环境需更换）
- `HOST=0.0.0.0`: 服务器监听地址
- `PORT=8000`: 服务器端口

**Section sources**
- [.env.example](file://.env.example#L1-L378)

## 数据库初始化
在启动系统前，需要创建数据库表结构。

### 执行表创建脚本
运行以下命令创建数据库表：
```bash
python create_tables.py
```

该脚本将：
1. 测试数据库连接
2. 创建`btc_usdt`和`eth_usdt`等K线数据表
3. 验证表创建结果

### 预期输出
成功执行后，您将看到类似以下输出：
```
🐢 缠论分析系统 - 数据库初始化
========================================
📋 数据库连接: localhost:5432/turtle
🔍 测试数据库连接...
✅ 数据库连接成功
🏗️ 创建数据库表...
✅ btc_usdt表: 存在 (0 条记录)
ℹ️ eth_usdt表: 未创建（正常，当前只使用BTC/USDT）
✅ 数据库表创建成功！
```

### 数据库状态检查
您还可以检查数据库当前状态：
```bash
python create_tables.py --check
```

**Section sources**
- [create_tables.py](file://create_tables.py#L1-L190)

## 系统启动方式
系统提供多种启动方式，适用于不同场景。

### 快速启动（推荐）
使用快速启动脚本，它会自动检查环境并引导您完成启动：
```bash
python quick_start.py
```

此脚本将执行以下步骤：
1. 检查Python版本
2. 创建必要目录（logs, static, data）
3. 检查数据库连接
4. 验证Chan模块可用性
5. 检查依赖包
6. 启动API服务器

### 手动启动
直接运行主启动脚本：
```bash
python run.py
```

### 开发模式启动
在开发环境中，使用Uvicorn的热重载功能：
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 启动信息
成功启动后，您将看到以下信息：
- **API服务**: http://localhost:8000
- **API文档**: http://localhost:8000/api/v1/docs
- **健康检查**: http://localhost:8000/health

**Section sources**
- [quick_start.py](file://quick_start.py#L1-L271)
- [run.py](file://run.py#L1-L11)
- [README.md](file://README.md#L1-L508)

## 常见问题排查
以下是初始化过程中常见的问题及解决方案。

### 数据库连接失败
**症状**：
```
❌ 数据库连接失败: could not connect to server
```

**解决方案**：
1. 确认数据库服务已启动：
```bash
# Linux
sudo systemctl status postgresql

# macOS
brew services list | grep postgresql
```
2. 检查`.env`文件中的`DATABASE_URL`配置
3. 确认数据库已创建：`CREATE DATABASE turtle;`

### Chan模块不可用
**症状**：
```
⚠️ Chan模块不可用，将使用简化分析
```

**解决方案**：
1. 重新初始化子模块：
```bash
git submodule update --init --recursive
```
2. 确认`chan.py`目录存在且非空

### 依赖安装错误
**症状**：
```
❌ 需要Python 3.8或更高版本
```

**解决方案**：
1. 检查Python版本：
```bash
python --version
```
2. 升级Python到3.8+
3. 如果使用虚拟环境，请确保激活正确的环境

### API连接超时
**症状**：
数据获取失败，连接超时

**解决方案**：
1. 检查网络连接：
```bash
curl -I https://api.binance.com/api/v3/ping
```
2. 调整`.env`文件中的超时配置：
```bash
API_TIMEOUT=60
```

**Section sources**
- [README.md](file://README.md#L1-L508)
- [quick_start.py](file://quick_start.py#L1-L271)
- [create_tables.py](file://create_tables.py#L1-L190)

## 总结
通过本指南，您已经完成了缠论分析系统的完整搭建流程。系统现已准备就绪，可以通过API接口或Web界面进行访问。推荐的使用流程是：首先使用`quick_start.py`进行快速启动，然后通过API文档探索系统功能。对于开发者，可以使用开发模式启动以获得热重载功能。遇到问题时，可参考日志文件`logs/app.log`进行诊断。

**Section sources**
- [README.md](file://README.md#L1-L508)
- [quick_start.py](file://quick_start.py#L1-L271)