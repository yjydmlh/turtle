# æ‰‹åŠ¨è§¦å‘æ•°æ®æ‹‰å–

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**  
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py)
- [simple_fetch_data.py](file://app/scripts/simple_fetch_data.py)
- [exceptions.py](file://app/core/exceptions.py)
- [kline.py](file://app/schemas/kline.py)
- [api.py](file://app/api/v1/api.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [æ¥å£æ¦‚è¿°](#æ¥å£æ¦‚è¿°)
3. [å¼‚æ­¥æ“ä½œæœºåˆ¶](#å¼‚æ­¥æ“ä½œæœºåˆ¶)
4. [å“åº”ç»“æ„è¯´æ˜](#å“åº”ç»“æ„è¯´æ˜)
5. [è°ƒç”¨ç¤ºä¾‹](#è°ƒç”¨ç¤ºä¾‹)
6. [é”™è¯¯å¤„ç†ä¸é‡è¯•ç­–ç•¥](#é”™è¯¯å¤„ç†ä¸é‡è¯•ç­–ç•¥)
7. [è‡ªåŠ¨åŒ–è„šæœ¬æœ€ä½³å®è·µ](#è‡ªåŠ¨åŒ–è„šæœ¬æœ€ä½³å®è·µ)

## ç®€ä»‹

`/simple/fetch-data` æ˜¯ç¼ è®ºåˆ†æç³»ç»Ÿä¸­çš„å…³é”®APIç«¯ç‚¹ï¼Œç”¨äºæ‰‹åŠ¨è§¦å‘ä»å¸å®‰ï¼ˆBinanceï¼‰APIæ‹‰å–æœ€æ–°å¸‚åœºæ•°æ®çš„åå°ä»»åŠ¡ã€‚è¯¥æ¥å£è®¾è®¡ä¸ºå¼‚æ­¥æ‰§è¡Œï¼Œè°ƒç”¨åç«‹å³è¿”å›ï¼Œä¸é˜»å¡å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé€‚åˆé›†æˆåˆ°è‡ªåŠ¨åŒ–æµç¨‹æˆ–ç”¨æˆ·ç•Œé¢ä¸­ã€‚

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜è¯¥æ¥å£çš„è¡Œä¸ºç‰¹æ€§ã€è¿”å›ç»“æ„ã€ä½¿ç”¨å»ºè®®åŠåœ¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸­çš„å®‰å…¨è°ƒç”¨æ–¹å¼ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…å› æ•°æ®å»¶è¿Ÿè€Œå¯¼è‡´çš„è¯¯åˆ¤ã€‚

## æ¥å£æ¦‚è¿°

`POST /api/v1/simple/fetch-data` ç«¯ç‚¹ç”¨äºè§¦å‘åå°æ•°æ®è·å–ä»»åŠ¡ï¼Œä»å¸å®‰APIè·å–æœ€è¿‘2å°æ—¶çš„1åˆ†é’ŸKçº¿æ•°æ®ï¼Œå¹¶å°†å…¶èšåˆå­˜å‚¨åˆ°æœ¬åœ°æ•°æ®åº“ä¸­ã€‚æ­¤æ“ä½œæ˜¯ç³»ç»Ÿæ›´æ–°å¸‚åœºæ•°æ®çš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ã€‚

è¯¥æ¥å£å±äºç®€åŒ–ç‰ˆKçº¿APIæ¨¡å—ï¼Œé€šè¿‡ `kline_simple.py` ä¸­çš„ `fetch_new_data()` å‡½æ•°å®ç°ï¼Œç”± `SimpleBinanceDataFetcher` ç±»è´Ÿè´£ä¸å¸å®‰APIé€šä¿¡å¹¶å¤„ç†æ•°æ®æŒä¹…åŒ–ã€‚

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L142-L176)
- [simple_fetch_data.py](file://app/scripts/simple_fetch_data.py#L43-L85)

## å¼‚æ­¥æ“ä½œæœºåˆ¶

è¯¥æ¥å£é‡‡ç”¨**å¼‚æ­¥éé˜»å¡è®¾è®¡**ï¼Œå…¶æ ¸å¿ƒè¡Œä¸ºå¦‚ä¸‹ï¼š

1. **ç«‹å³å“åº”**ï¼šå½“å®¢æˆ·ç«¯å‘é€POSTè¯·æ±‚åï¼ŒæœåŠ¡å™¨ç«‹å³å¯åŠ¨ä¸€ä¸ªåå°ä»»åŠ¡æ¥è·å–æ•°æ®ï¼Œä½†ä¸ä¼šç­‰å¾…ä»»åŠ¡å®Œæˆã€‚
2. **åå°æ‰§è¡Œ**ï¼šæ•°æ®è·å–å’Œæ•°æ®åº“å†™å…¥æ“ä½œåœ¨æœåŠ¡å™¨ç«¯å¼‚æ­¥æ‰§è¡Œï¼Œå¯èƒ½éœ€è¦æ•°ç§’æ—¶é—´å®Œæˆã€‚
3. **ä¸ä¿è¯å³æ—¶å¯è§**ï¼šè°ƒç”¨æˆåŠŸè¿”å›åï¼Œæ–°æ•°æ®**å°šæœªå®Œå…¨å†™å…¥æ•°æ®åº“**ï¼Œç›´æ¥æŸ¥è¯¢å¯èƒ½æ— æ³•çœ‹åˆ°æœ€æ–°ç»“æœã€‚

è¿™ç§è®¾è®¡é¿å…äº†é•¿æ—¶é—´çš„HTTPè¿æ¥ç­‰å¾…ï¼Œæå‡äº†ç³»ç»Ÿå“åº”æ€§ï¼Œä½†ä¹Ÿè¦æ±‚è°ƒç”¨è€…ç†è§£å…¶å»¶è¿Ÿç‰¹æ€§ã€‚

### å»ºè®®ç­‰å¾…ç­–ç•¥

ä¸ºç¡®ä¿æ•°æ®å·²å†™å…¥ï¼Œå»ºè®®åœ¨è°ƒç”¨æ­¤æ¥å£åï¼š

1. **ç­‰å¾…2-3ç§’**ï¼šè®©åå°ä»»åŠ¡æœ‰è¶³å¤Ÿæ—¶é—´å®Œæˆæ•°æ®è·å–å’Œæ•°æ®åº“æäº¤ã€‚
2. **å†æŸ¥è¯¢æ•°æ®**ï¼šä½¿ç”¨ `/api/v1/simple/klines` æˆ– `/api/v1/simple/latest` è·å–æœ€æ–°Kçº¿æ•°æ®ã€‚

è¿™ä¸€å»ºè®®å·²åœ¨å“åº”çš„ `next_steps` å­—æ®µä¸­æ˜ç¡®æç¤ºã€‚

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L168-L176)
- [simple_fetch_data.py](file://app/scripts/simple_fetch_data.py#L75-L105)

## å“åº”ç»“æ„è¯´æ˜

æˆåŠŸè°ƒç”¨è¯¥æ¥å£åï¼Œè¿”å›æ ‡å‡†çš„JSONå“åº”ç»“æ„ï¼Œéµå¾ªç³»ç»Ÿç»Ÿä¸€çš„æˆåŠŸå“åº”æ ¼å¼ã€‚

```json
{
  "success": true,
  "code": 0,
  "message": "æ•°æ®è·å–æˆåŠŸ",
  "data": {
    "status": "success",
    "hours_fetched": 2,
    "note": "æ•°æ®å·²æ›´æ–°ï¼Œå»ºè®®ç­‰å¾…2-3ç§’åé‡æ–°æŸ¥è¯¢Kçº¿æ•°æ®",
    "next_steps": [
      "ç­‰å¾…2-3ç§’è®©æ•°æ®å†™å…¥å®Œæˆ",
      "è°ƒç”¨ /api/v1/simple/klines æŸ¥çœ‹æ–°æ•°æ®",
      "è°ƒç”¨ /api/v1/chan/analyze è¿›è¡Œç¼ è®ºåˆ†æ"
    ]
  }
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `success` | boolean | æ“ä½œæ˜¯å¦æˆåŠŸ |
| `code` | integer | çŠ¶æ€ç ï¼Œ0è¡¨ç¤ºæˆåŠŸ |
| `message` | string | ç®€è¦æè¿°ä¿¡æ¯ |
| `data.status` | string | æ•°æ®è·å–çŠ¶æ€ï¼ˆå¦‚ "success"ï¼‰ |
| `data.hours_fetched` | integer | è·å–çš„æ—¶é—´èŒƒå›´ï¼ˆå°æ—¶ï¼‰ |
| `data.note` | string | æ“ä½œæç¤ºï¼ŒåŒ…å«ç­‰å¾…å»ºè®® |
| `data.next_steps` | array[string] | åç»­æ“ä½œå»ºè®®åˆ—è¡¨ |

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L168-L176)
- [exceptions.py](file://app/core/exceptions.py#L95-L110)

## è°ƒç”¨ç¤ºä¾‹

### ä½¿ç”¨ curl å‘½ä»¤

```bash
# è§¦å‘æ•°æ®æ‹‰å–
curl -X POST "http://localhost:8000/api/v1/simple/fetch-data"

# æ¨èï¼šç­‰å¾…2-3ç§’åæŸ¥è¯¢æœ€æ–°Kçº¿
sleep 3
curl "http://localhost:8000/api/v1/simple/latest?timeframe=1h&count=10"
```

### ä½¿ç”¨ Python è„šæœ¬

```python
import requests
import time

# 1. è§¦å‘æ•°æ®è·å–
response = requests.post("http://localhost:8000/api/v1/simple/fetch-data")
result = response.json()

if result["success"]:
    print("âœ… æ•°æ®è·å–ä»»åŠ¡å·²å¯åŠ¨")
    
    # 2. éµå¾ªå»ºè®®ï¼šç­‰å¾…2-3ç§’
    print("â³ ç­‰å¾…2ç§’è®©æ•°æ®å†™å…¥...")
    time.sleep(2)
    
    # 3. æŸ¥è¯¢æœ€æ–°æ•°æ®
    kline_response = requests.get(
        "http://localhost:8000/api/v1/simple/latest",
        params={"timeframe": "1h", "count": 5}
    )
    print("ğŸ“Š æœ€æ–°Kçº¿æ•°æ®:", kline_response.json())
else:
    print("âŒ æ•°æ®è·å–å¤±è´¥:", result["message"])
```

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L142-L176)
- [simple_fetch_data.py](file://app/scripts/simple_fetch_data.py#L347-L391)

## é”™è¯¯å¤„ç†ä¸é‡è¯•ç­–ç•¥

å½“æ•°æ®è·å–å¤±è´¥æ—¶ï¼Œæ¥å£ä¼šè¿”å›é”™è¯¯å“åº”ï¼ŒåŒ…å«é”™è¯¯ç å’Œæè¿°ä¿¡æ¯ã€‚

```json
{
  "success": false,
  "code": 5001,
  "message": "æ•°æ®è·å–å¤±è´¥",
  "data": null
}
```

### å¸¸è§é”™è¯¯åŸå› 

- **ç½‘ç»œè¿æ¥é—®é¢˜**ï¼šæ— æ³•è¿æ¥å¸å®‰API
- **APIé™æµ**ï¼šè¯·æ±‚è¿‡äºé¢‘ç¹
- **æ•°æ®åº“å¼‚å¸¸**ï¼šå†™å…¥å¤±è´¥
- **æ•°æ®éªŒè¯å¤±è´¥**ï¼šKçº¿æ•°æ®æ ¼å¼å¼‚å¸¸

### å®‰å…¨é‡è¯•é€»è¾‘

åœ¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸­ï¼Œåº”å®ç°å¸¦é€€é¿çš„é‡è¯•æœºåˆ¶ï¼š

```python
import time
import requests
from typing import Dict

def safe_fetch_data(max_retries: int = 3, backoff_factor: float = 1.5) -> Dict:
    """å®‰å…¨åœ°è°ƒç”¨æ•°æ®æ‹‰å–æ¥å£ï¼ŒåŒ…å«é‡è¯•é€»è¾‘"""
    url = "http://localhost:8000/api/v1/simple/fetch-data"
    
    for attempt in range(max_retries):
        try:
            response = requests.post(url, timeout=10)
            result = response.json()
            
            if result["success"]:
                print(f"âœ… æ•°æ®è·å–æˆåŠŸ (å°è¯• {attempt + 1})")
                return result
                
            print(f"âš ï¸ è·å–å¤±è´¥ (å°è¯• {attempt + 1}): {result['message']}")
            
        except requests.RequestException as e:
            print(f"âš ï¸ è¯·æ±‚å¼‚å¸¸ (å°è¯• {attempt + 1}): {e}")
        
        # è®¡ç®—é€€é¿æ—¶é—´
        if attempt < max_retries - 1:
            wait_time = backoff_factor ** attempt
            print(f"ğŸ” {wait_time}ç§’åé‡è¯•...")
            time.sleep(wait_time)
    
    raise Exception(f"âŒ ç»è¿‡{max_retries}æ¬¡é‡è¯•åä»å¤±è´¥")

# ä½¿ç”¨ç¤ºä¾‹
try:
    result = safe_fetch_data()
    time.sleep(3)  # ç­‰å¾…æ•°æ®å†™å…¥
    # ç»§ç»­åç»­åˆ†æ...
except Exception as e:
    print(f"æ“ä½œå¤±è´¥: {e}")
```

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L170-L175)
- [exceptions.py](file://app/core/exceptions.py#L75-L94)

## è‡ªåŠ¨åŒ–è„šæœ¬æœ€ä½³å®è·µ

ä¸ºç¡®ä¿åœ¨è‡ªåŠ¨åŒ–æµç¨‹ä¸­æ­£ç¡®ä½¿ç”¨æ­¤æ¥å£ï¼Œè¯·éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š

1. **å§‹ç»ˆç­‰å¾…**ï¼šè°ƒç”¨åå¿…é¡»ç­‰å¾…2-3ç§’å†æŸ¥è¯¢æ•°æ®ã€‚
2. **æ£€æŸ¥å“åº”**ï¼šå…ˆéªŒè¯ `success` å­—æ®µï¼Œå†è¿›è¡Œåç»­æ“ä½œã€‚
3. **å®ç°é‡è¯•**ï¼šå¯¹ç½‘ç»œæˆ–ä¸´æ—¶é”™è¯¯å®ç°æŒ‡æ•°é€€é¿é‡è¯•ã€‚
4. **é¿å…é«˜é¢‘è°ƒç”¨**ï¼šè¯¥æ¥å£å·²å¯ç”¨é€Ÿç‡é™åˆ¶ï¼Œé¢‘ç¹è°ƒç”¨å¯èƒ½å¯¼è‡´å¤±è´¥ã€‚
5. **ç»“åˆå¥åº·æ£€æŸ¥**ï¼šå¯å…ˆè°ƒç”¨ `/health` ç¡®è®¤ç³»ç»ŸçŠ¶æ€ã€‚

é€šè¿‡éµå¾ªè¿™äº›å®è·µï¼Œå¯ä»¥ç¡®ä¿æ•°æ®è·å–æµç¨‹çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L142-L176)
- [simple_fetch_data.py](file://app/scripts/simple_fetch_data.py#L43-L85)
- [api.py](file://app/api/v1/api.py#L0-L12)