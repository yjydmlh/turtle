# 支持的时间周期查询

<cite>
**本文档引用的文件**  
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py)
- [kline_aggregator.py](file://app/services/kline_aggregator.py)
- [api.js](file://frontend/src/lib/api.js)
- [utils.js](file://frontend/src/lib/utils.js)
</cite>

## 目录
1. [简介](#简介)
2. [API端点说明](#api端点说明)
3. [响应结构与JSON Schema](#响应结构与json-schema)
4. [使用示例](#使用示例)
5. [前端集成应用](#前端集成应用)
6. [最佳实践建议](#最佳实践建议)

## 简介

`/simple/timeframes` 是交易系统中的一个关键API端点，用于查询系统当前支持的所有K线时间周期及其对应的中文描述。该接口为客户端（尤其是前端应用）提供了一个前置调用机制，使得应用能够在初始化或用户交互前准确了解后端支持的时间范围选项。

此信息对于构建动态UI组件（如下拉菜单）、进行参数校验以及提升用户体验至关重要。系统通过聚合1分钟原始K线数据来生成更高级别的周期数据，确保了数据的一致性和高效性。

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L1-L39)
- [kline_aggregator.py](file://app/services/kline_aggregator.py#L1-L251)

## API端点说明

### 端点信息
- **路径**: `/api/v1/simple/timeframes`
- **方法**: `GET`
- **功能**: 获取系统支持的所有K线时间周期列表
- **前置调用重要性**: 在调用其他依赖时间周期参数的API（如获取K线数据）之前，客户端应首先调用此接口以确保所选周期被支持，避免无效请求。

### 支持的时间周期
系统当前支持以下7种时间周期：

| 时间周期代码 | 中文描述 |
|-------------|--------|
| `1m` | 1分钟 |
| `5m` | 5分钟 |
| `15m` | 15分钟 |
| `30m` | 30分钟 |
| `1h` | 1小时 |
| `4h` | 4小时 |
| `1d` | 1天 |

> **备注**: 所有周期数据均由1分钟K线聚合生成，确保数据源统一。

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L12-L38)
- [kline_aggregator.py](file://app/services/kline_aggregator.py#L22-L30)

## 响应结构与JSON Schema

### 成功响应结构
当请求成功时，API返回标准的成功响应格式，包含 `data`、`description` 和 `note` 字段。

```json
{
  "success": true,
  "data": {
    "timeframes": ["1m", "5m", "15m", "30m", "1h", "4h", "1d"],
    "description": {
      "1m": "1分钟",
      "5m": "5分钟",
      "15m": "15分钟",
      "30m": "30分钟",
      "1h": "1小时",
      "4h": "4小时",
      "1d": "1天"
    },
    "note": "系统自动将1分钟K线聚合为其他时间周期"
  },
  "message": "操作成功",
  "code": 200
}
```

### JSON Schema 定义
```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "success": {
      "type": "boolean",
      "description": "请求是否成功"
    },
    "data": {
      "type": "object",
      "properties": {
        "timeframes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["1m", "5m", "15m", "30m", "1h", "4h", "1d"]
          },
          "description": "支持的时间周期代码列表"
        },
        "description": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "时间周期代码与中文描述的映射"
        },
        "note": {
          "type": "string",
          "description": "附加说明信息"
        }
      },
      "required": ["timeframes", "description"]
    },
    "message": {
      "type": "string",
      "description": "响应消息"
    },
    "code": {
      "type": "integer",
      "description": "状态码"
    }
  },
  "required": ["success", "data", "message", "code"]
}
```

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L12-L38)

## 使用示例

### 使用 curl 命令获取支持的周期
```bash
curl -X GET "http://localhost:8000/api/v1/simple/timeframes"
```

### 使用 Python requests 获取并解析
```python
import requests

# 发起请求
response = requests.get("http://localhost:8000/api/v1/simple/timeframes")
data = response.json()

if data["success"]:
    timeframes = data["data"]["timeframes"]
    descriptions = data["data"]["description"]
    
    print("支持的时间周期:")
    for tf in timeframes:
        print(f"  {tf}: {descriptions[tf]}")
else:
    print(f"请求失败: {data['message']}")
```

**Section sources**
- [api.js](file://frontend/src/lib/api.js#L85-L95)

## 前端集成应用

### 构建下拉菜单
前端可利用此API返回的数据动态生成时间周期选择器：

```javascript
// 获取支持的时间周期
async function buildTimeframeDropdown() {
    const response = await getTimeframes();
    const timeframes = response.data.timeframes;
    const descriptions = response.data.description;

    const select = document.getElementById('timeframe-select');
    timeframes.forEach(tf => {
        const option = document.createElement('option');
        option.value = tf;
        option.textContent = descriptions[tf];
        select.appendChild(option);
    });
}
```

### 参数验证
在调用 `/simple/klines` 等接口前，可先验证用户选择的时间周期是否有效：

```javascript
function isValidTimeframe(selected) {
    const supported = await getTimeframes();
    return supported.data.timeframes.includes(selected);
}
```

### 工具函数集成
前端已内置 `getTimeframeText` 工具函数，可直接将时间周期代码转换为中文：

```javascript
import { getTimeframeText } from './utils.js';

console.log(getTimeframeText('1h')); // 输出: "1小时"
```

**Section sources**
- [api.js](file://frontend/src/lib/api.js#L85-L95)
- [utils.js](file://frontend/src/lib/utils.js#L134-L189)

## 最佳实践建议

1. **缓存响应结果**：由于支持的时间周期相对稳定，建议客户端对 `/simple/timeframes` 的响应进行缓存（如30分钟），以减少不必要的网络请求。
2. **启动时预加载**：应用启动时应优先调用此接口，确保后续功能模块能立即使用有效的时间周期列表。
3. **错误处理**：尽管该接口极少出错，但仍需处理500等异常情况，可设置默认周期列表作为降级方案。
4. **与后端保持同步**：避免在前端硬编码时间周期列表，始终依赖API返回的数据，确保前后端一致性。

**Section sources**
- [kline_simple.py](file://app/api/v1/endpoints/kline_simple.py#L12-L38)
- [utils.js](file://frontend/src/lib/utils.js#L134-L189)